
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>NumPy: creating and manipulating numerical data &mdash; Scipy lecture notes</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2011.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Scipy lecture notes" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Scipy lecture notes</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
          <div class="body">
            
  <div class="section" id="numpy-creating-and-manipulating-numerical-data">
<h1>NumPy: creating and manipulating numerical data<a class="headerlink" href="#numpy-creating-and-manipulating-numerical-data" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">authors:</th><td class="field-body">Emmanuelle Gouillart, Didrik Pinte, Gaël Varoquaux, and Pauli Virtanen</td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="chapters-contents">
<p class="topic-title first">Chapters contents</p>
<ul class="simple">
<li><a class="reference internal" href="#the-numpy-array-object" id="id2">The numpy array object</a><ul>
<li><a class="reference internal" href="#what-are-numpy-and-numpy-arrays" id="id3">What are Numpy and numpy arrays</a></li>
<li><a class="reference internal" href="#reference-documentation" id="id4">Reference documentation</a></li>
<li><a class="reference internal" href="#creating-arrays" id="id5">Creating arrays</a></li>
<li><a class="reference internal" href="#basic-data-types" id="id6">Basic data types</a></li>
<li><a class="reference internal" href="#basic-visualization" id="id7">Basic visualization</a></li>
<li><a class="reference internal" href="#indexing-and-slicing" id="id8">Indexing and slicing</a></li>
<li><a class="reference internal" href="#copies-and-views" id="id9">Copies and views</a></li>
<li><a class="reference internal" href="#fancy-indexing" id="id10">Fancy indexing</a><ul>
<li><a class="reference internal" href="#using-boolean-masks" id="id11">Using boolean masks</a></li>
<li><a class="reference internal" href="#indexing-with-an-array-of-integers" id="id12">Indexing with an array of integers</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#numerical-operations-on-arrays" id="id13">Numerical operations on arrays</a><ul>
<li><a class="reference internal" href="#elementwise-operations" id="id14">Elementwise operations</a></li>
<li><a class="reference internal" href="#basic-reductions" id="id15">Basic reductions</a></li>
<li><a class="reference internal" href="#broadcasting" id="id16">Broadcasting</a></li>
<li><a class="reference internal" href="#array-shape-manipulation" id="id17">Array shape manipulation</a></li>
<li><a class="reference internal" href="#sorting-data" id="id18">Sorting data</a></li>
<li><a class="reference internal" href="#some-excercices" id="id19">Some excercices</a></li>
<li><a class="reference internal" href="#summary" id="id20">Summary</a></li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-operations" id="id21">Advanced operations</a><ul>
<li><a class="reference internal" href="#fourier-transforms" id="id22">Fourier transforms</a></li>
<li><a class="reference internal" href="#polynomials" id="id23">Polynomials</a></li>
<li><a class="reference internal" href="#summary-exercises" id="id24">Summary &amp; Exercises</a></li>
</ul>
</li>
<li><a class="reference internal" href="#loading-data-files" id="id25">Loading data files</a><ul>
<li><a class="reference internal" href="#text-files" id="id26">Text files</a></li>
<li><a class="reference internal" href="#images" id="id27">Images</a></li>
<li><a class="reference internal" href="#numpy-s-own-format" id="id28">Numpy&#8217;s own format</a></li>
<li><a class="reference internal" href="#well-known-more-obscure-file-formats" id="id29">Well-known (&amp; more obscure) file formats</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-elaborate-arrays" id="id30">More elaborate arrays</a><ul>
<li><a class="reference internal" href="#more-data-types" id="id31">More data types</a></li>
<li><a class="reference internal" href="#structured-data-types" id="id32">Structured data types</a></li>
<li><a class="reference internal" href="#masked-arrays" id="id33">Masked arrays</a></li>
</ul>
</li>
<li><a class="reference internal" href="#under-the-hood-the-memory-layout-of-a-numpy-array" id="id34">Under the hood: the memory layout of a numpy array</a><ul>
<li><a class="reference internal" href="#block-of-memory" id="id35">Block of memory</a></li>
<li><a class="reference internal" href="#indexing-scheme-strides" id="id36">Indexing scheme: strides</a></li>
<li><a class="reference internal" href="#id1" id="id37">Summary</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="the-numpy-array-object">
<h2><a class="toc-backref" href="#id2">The numpy array object</a><a class="headerlink" href="#the-numpy-array-object" title="Permalink to this headline">¶</a></h2>
<div class="section" id="what-are-numpy-and-numpy-arrays">
<h3><a class="toc-backref" href="#id3">What are Numpy and numpy arrays</a><a class="headerlink" href="#what-are-numpy-and-numpy-arrays" title="Permalink to this headline">¶</a></h3>
<p><strong>Python</strong> has built-in:</p>
<blockquote>
<div><ul class="simple">
<li>containers: lists (costless insertion and append), dictionnaries
(fast lookup)</li>
<li>high-level number objects: integers, floating point</li>
</ul>
</div></blockquote>
<p><strong>Numpy</strong> is:</p>
<blockquote>
<div><ul class="simple">
<li>extension package to Python for multidimensional arrays</li>
<li>closer to hardware (efficiency)</li>
<li>designed for scientific computation (convenience)</li>
</ul>
</div></blockquote>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3])</span>
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">For example:</p>
<p>An array containing:</p>
<ul class="simple">
<li>discretized time of an experiment/simulation</li>
<li>signal recorded by a measurement device</li>
<li>pixels of an image</li>
<li>...</li>
</ul>
</div>
<p><strong>Why it is useful:</strong> Memory-efficient and fast container for numerical
operations.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">l</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="gp">In [2]: </span><span class="o">%</span><span class="n">timeit</span> <span class="p">[</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">]</span>
<span class="go">1000 loops, best of 3: 403 us per loop</span>

<span class="gp">In [3]: </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="gp">In [4]: </span><span class="o">%</span><span class="n">timeit</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>
<span class="go">100000 loops, best of 3: 12.7 us per loop</span>
</pre></div>
</div>
</div>
<div class="section" id="reference-documentation">
<h3><a class="toc-backref" href="#id4">Reference documentation</a><a class="headerlink" href="#reference-documentation" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">On the web: <a class="reference external" href="http://docs.scipy.org/">http://docs.scipy.org/</a></p>
</li>
<li><p class="first">Interactive help:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
<span class="go">array(object, dtype=None, copy=True, order=None, subok=False, ndmin=0)</span>

<span class="go">Create an array.</span>

<span class="go">Parameters</span>
<span class="go">----------</span>
<span class="go">object : array_like</span>
<span class="gp">...</span>

<span class="go">Examples</span>
<span class="go">--------</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="go">array([1, 2, 3])</span>
<span class="gp">...</span>
</pre></div>
</div>
</li>
<li><p class="first">Looking for something:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">lookfor</span><span class="p">(</span><span class="s">&#39;create array&#39;</span><span class="p">)</span>
<span class="go">Search results for &#39;create array&#39;</span>
<span class="go">---------------------------------</span>
<span class="go">numpy.array</span>
<span class="go">    Create an array.</span>
<span class="go">numpy.memmap</span>
<span class="go">    Create a memory-map to an array stored in a *binary* file on disk.</span>
<span class="gp">...</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">lookfor</span><span class="p">)</span>
<span class="gp">...</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="creating-arrays">
<h3><a class="toc-backref" href="#id5">Creating arrays</a><a class="headerlink" href="#creating-arrays" title="Permalink to this headline">¶</a></h3>
<p><strong>1-D</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ndim</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">4</span>
</pre></div>
</div>
<p><strong>2-D, 3-D, ...</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>    <span class="c"># 2 x 3 array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([[ 0,  1,  2],</span>
<span class="go">       [ 3,  4,  5]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">ndim</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>     <span class="c"># returns the size of the first dimension</span>
<span class="go">2</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">]]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([[[1],</span>
<span class="go">        [2]],</span>

<span class="go">       [[3],</span>
<span class="go">        [4]]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 2, 1)</span>
</pre></div>
</div>
<p>In practice, we rarely enter items one by one...</p>
<blockquote>
<div><ul>
<li><p class="first">Evenly spaced:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c"># 0 .. n-1  (!)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c"># start, end (exlusive), step</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([1, 3, 5, 7])</span>
</pre></div>
</div>
<p>or by number of points:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>   <span class="c"># start, end, num-points</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([ 0. ,  0.2,  0.4,  0.6,  0.8,  1. ])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">array([ 0. ,  0.2,  0.4,  0.6,  0.8])</span>
</pre></div>
</div>
</li>
<li><p class="first">Common arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c"># reminder: (3, 3) is a tuple</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([[ 0.,  0.],</span>
<span class="go">       [ 0.,  0.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([[ 1.,  0.,  0.],</span>
<span class="go">       [ 0.,  1.,  0.],</span>
<span class="go">       [ 0.,  0.,  1.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">array([[1, 0, 0, 0],</span>
<span class="go">       [0, 2, 0, 0],</span>
<span class="go">       [0, 0, 3, 0],</span>
<span class="go">       [0, 0, 0, 4])</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="xref py py-obj docutils literal"><span class="pre">np.random</span></tt>: random numbers (Mersenne Twister PRNG):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>       <span class="c"># uniform in [0, 1]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([ 0.58597729,  0.86110455,  0.9401114 ,  0.54264348])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>      <span class="c"># Gaussian</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([-2.56844807,  0.06798064, -0.36823781,  0.86966886])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>        <span class="c"># Setting the random seed</span>
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<div class="green topic">
<p class="topic-title first"><strong>Exercise: Array creation</strong></p>
<p>Create the following arrays (with correct data types):</p>
<div class="highlight-python"><pre>[[ 1  1  1  1]
[ 1  1  1  1]
[ 1  1  1  2]
[ 1  6  1  1]]

[[0. 0. 0. 0. 0.]
[2. 0. 0. 0. 0.]
[0. 3. 0. 0. 0.]
[0. 0. 4. 0. 0.]
[0. 0. 0. 5. 0.]
[0. 0. 0. 0. 6.]]</pre>
</div>
<p>Par on course: 3 statements for each</p>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Tiling for array creation</p>
<p>Skim through the documentation for <tt class="docutils literal"><span class="pre">np.tile</span></tt>, and use this function
to construct the array:</p>
<div class="highlight-python"><pre>[[4 3 4 3 4 3]
[2 1 2 1 2 1]
[4 3 4 3 4 3]
[2 1 2 1 2 1]]</pre>
</div>
</div>
</div>
<div class="section" id="basic-data-types">
<h3><a class="toc-backref" href="#id6">Basic data types</a><a class="headerlink" href="#basic-data-types" title="Permalink to this headline">¶</a></h3>
<p>You probably noted the <tt class="docutils literal"><span class="pre">1</span></tt> and <tt class="docutils literal"><span class="pre">1.</span></tt> above. These are different
data types:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
</pre></div>
</div>
<p>Much of the time you don&#8217;t necessarily need to care, but remember they
are there.</p>
<hr class="docutils" />
<p>You can also choose which one you want:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
</pre></div>
</div>
<p>The <strong>default</strong> data type is floating point:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;float64&#39;)</span>
</pre></div>
</div>
<p>There are also other types:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Complex</td>
<td><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="o">+</span><span class="mi">4</span><span class="n">j</span><span class="p">,</span> <span class="mi">5</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;complex128&#39;)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Bool</td>
<td><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;bool&#39;)</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Strings</td>
<td><div class="first last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s">&#39;Bonjour&#39;</span><span class="p">,</span> <span class="s">&#39;Hello&#39;</span><span class="p">,</span> <span class="s">&#39;Hallo&#39;</span><span class="p">,])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;S7&#39;)         # &lt;--- strings containing max. 7 letters</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td>Much more: int32/int64...</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="basic-visualization">
<h3><a class="toc-backref" href="#id7">Basic visualization</a><a class="headerlink" href="#basic-visualization" title="Permalink to this headline">¶</a></h3>
<p>Now that we have our first data arrays, we are going to visualize them.</p>
<p><strong>Matplotlib</strong> is a 2D plotting package. We can import its functions as below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>  <span class="c"># the tidy way</span>
</pre></div>
</div>
<p>The recommended way of working is use <tt class="xref py py-obj docutils literal"><span class="pre">IPython</span></tt>, started in <tt class="xref py py-obj docutils literal"><span class="pre">pylab</span></tt> mode:</p>
<div class="highlight-python"><pre>$ ipython -pylab</pre>
</div>
<p><strong>1D plotting</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>       <span class="c"># line plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>  <span class="c"># dot plot</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>           <span class="c"># &lt;-- shows the plot (not needed with Ipython)</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_1.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_1.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_1.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_1.png" src="../../_images/numpy_intro_1.png" />
<p><strong>2D arrays</strong> (such as images)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_2.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_2.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_2.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_2.png" src="../../_images/numpy_intro_2.png" />
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">More in the <a class="reference internal" href="../matplotlib/matplotlib.html#matplotlib"><em>matplotlib chapter</em></a></p>
</div>
<p><strong>3D plotting</strong></p>
<p>For 3D visualization, we can use another package: <strong>Mayavi</strong>. A quick example:
start with <strong>relaunching iPython</strong> with these options:
<strong>ipython -pylab -wthread</strong>  (or <strong>ipython &#8211;pylab=wx</strong> in IPython &gt;= 0.10).</p>
<a class="reference internal image-reference" href="../../_images/surf1.png"><img alt="../../_images/surf1.png" class="align-right" src="../../_images/surf1.png" style="width: 238.8px; height: 189.6px;" /></a>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [59]: </span><span class="kn">from</span> <span class="nn">enthought.mayavi</span> <span class="kn">import</span> <span class="n">mlab</span>
<span class="gp">In [60]: </span><span class="n">mlab</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="go">Out[60]: </span><span class="o">&lt;</span><span class="n">enthought</span><span class="o">.</span><span class="n">mayavi</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">Scene</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xcb2677c</span><span class="o">&gt;</span>
<span class="gp">In [61]: </span><span class="n">mlab</span><span class="o">.</span><span class="n">surf</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
<span class="go">Out[61]: </span><span class="o">&lt;</span><span class="n">enthought</span><span class="o">.</span><span class="n">mayavi</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">surface</span><span class="o">.</span><span class="n">Surface</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xd0862fc</span><span class="o">&gt;</span>
<span class="gp">In [62]: </span><span class="n">mlab</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
<span class="go">Out[62]: </span><span class="o">&lt;</span><span class="n">enthought</span><span class="o">.</span><span class="n">mayavi</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">Axes</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xd07892c</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The mayavi/mlab window that opens is interactive : by clicking on the left mouse button
you can rotate the image, zoom with the mouse wheel, etc.</p>
<p>For more information on Mayavi :
<a class="reference external" href="http://github.enthought.com/mayavi/mayavi">http://github.enthought.com/mayavi/mayavi</a></p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">More in the <a class="reference internal" href="../../advanced/3d_plotting/index.html#mayavi-label"><em>Mayavi chapter</em></a></p>
</div>
</div>
<div class="section" id="indexing-and-slicing">
<h3><a class="toc-backref" href="#id8">Indexing and slicing</a><a class="headerlink" href="#indexing-and-slicing" title="Permalink to this headline">¶</a></h3>
<p>The items of an array can be accessed and assigned to the same way as
other Python sequences (e.g. lists)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">(0, 2, 9)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Indices begin at 0, like other Python sequences (and C/C++).
In contrast, in Fortran or Matlab, indices begin at 1.</p>
</div>
<p>For multidimensional arrays, indexes are tuples of integers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[0, 0, 0],</span>
<span class="go">       [0, 1, 0],</span>
<span class="go">       [0, 0, 2]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span> <span class="c"># third line, second column</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  0,  0],</span>
<span class="go">       [ 0,  1,  0],</span>
<span class="go">       [ 0, 10,  2]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">array([0, 1, 0])</span>
</pre></div>
</div>
<p>Note that:</p>
<ul class="simple">
<li>In 2D, the first dimension corresponds to rows, the second to columns.</li>
<li>for multidimensional <tt class="docutils literal"><span class="pre">a</span></tt>, <tt class="xref py py-obj docutils literal"><span class="pre">a[0]</span></tt> is interpreted by
taking all elements in the unspecified dimensions.</li>
</ul>
<p><strong>Slicing</strong> Arrays, like other Python sequences can also be sliced:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">9</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="c"># [start:end:step]</span>
<span class="go">array([2, 5, 8])</span>
</pre></div>
</div>
<p>Note that the last index is not included!:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
<span class="go">array([0, 1, 2, 3])</span>
</pre></div>
</div>
<p>All three slice components are not required: by default, <tt class="xref py py-obj docutils literal"><span class="pre">start</span></tt> is 0,
<tt class="xref py py-obj docutils literal"><span class="pre">end</span></tt> is the last and <tt class="xref py py-obj docutils literal"><span class="pre">step</span></tt> is 1:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="go">array([1, 2])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
<span class="go">array([0, 2, 4, 6, 8])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="go">array([3, 4, 5, 6, 7, 8, 9])</span>
</pre></div>
</div>
<p>A small illustrated summary of Numpy indexing and slicing...</p>
<img alt="../../_images/numpy_indexing.png" class="align-center" src="../../_images/numpy_indexing.png" style="width: 100%;" />
</div>
<div class="section" id="copies-and-views">
<h3><a class="toc-backref" href="#id9">Copies and views</a><a class="headerlink" href="#copies-and-views" title="Permalink to this headline">¶</a></h3>
<p>A slicing operation creates a <strong>view</strong> on the original array, which is
just a way of accessing array data. Thus the original array is not
copied in memory.</p>
<p><strong>When modifying the view, the original array is modified as well</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">];</span> <span class="n">b</span>
<span class="go">array([0, 2, 4, 6, 8])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([12,  2,  4,  6,  8])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>   <span class="c"># (!)</span>
<span class="go">array([12,  1,  2,  3,  4,  5,  6,  7,  8,  9])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c"># force a copy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>
</pre></div>
</div>
<p>This behavior can be surprising at first sight... but it allows to save both
memory and time.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>The transpose is a view</strong></p>
<p>As a result, a matrix cannot be made symmetric in-place:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 2.,  2.,  2., ...,  2.,  2.,  2.],</span>
<span class="go">    [ 2.,  2.,  2., ...,  2.,  2.,  2.],</span>
<span class="go">    [ 2.,  2.,  2., ...,  2.,  2.,  2.],</span>
<span class="go">    ...,</span>
<span class="go">    [ 3.,  3.,  3., ...,  2.,  2.,  2.],</span>
<span class="go">    [ 3.,  3.,  3., ...,  2.,  2.,  2.],</span>
<span class="go">    [ 3.,  3.,  3., ...,  2.,  2.,  2.]])</span>
</pre></div>
</div>
</div>
<div class="green topic">
<p class="topic-title first">Worked example: Prime number sieve</p>
<img alt="../../_images/prime-sieve.png" src="../../_images/prime-sieve.png" />
<p>Compute prime numbers in 0&#8211;99, with a sieve</p>
<ul>
<li><p class="first">Construct a shape (100,) boolean array <tt class="docutils literal"><span class="pre">is_prime</span></tt>,
filled with True in the beginning:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_prime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Cross out 0 and 1 which are not primes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">is_prime</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">For each integer <tt class="docutils literal"><span class="pre">j</span></tt> starting from 2, cross out its higher multiples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">N_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">is_prime</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N_max</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">is_prime</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">::</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
</li>
<li><p class="first">Skim through <tt class="docutils literal"><span class="pre">help(np.nonzero)</span></tt>, and print the prime numbers</p>
</li>
<li><p class="first">Follow-up:</p>
<ul class="simple">
<li>Move the above code into a script file named <tt class="docutils literal"><span class="pre">prime_sieve.py</span></tt></li>
<li>Run it to check it works</li>
<li>Convert the simple sieve to <a class="reference external" href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">the sieve of Eratosthenes</a>:</li>
</ul>
<blockquote>
<div><ol class="arabic simple">
<li>Skip <tt class="xref py py-obj docutils literal"><span class="pre">j</span></tt> which are already known to not be primes</li>
<li>The first number to cross out is <img class="math" src="../../_images/math/d9714cf77a92cb89757ce29264f51a9edac2a072.png" alt="j^2" style="vertical-align: -6px"/></li>
</ol>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="fancy-indexing">
<h3><a class="toc-backref" href="#id10">Fancy indexing</a><a class="headerlink" href="#fancy-indexing" title="Permalink to this headline">¶</a></h3>
<p>Numpy arrays can be indexed with slices, but also with boolean or
integer arrays (<strong>masks</strong>). This method is called <em>fancy indexing</em>. It
creates <strong>copies not view</strong>.</p>
<div class="section" id="using-boolean-masks">
<h4><a class="toc-backref" href="#id11">Using boolean masks</a><a class="headerlink" href="#using-boolean-masks" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([10,  3,  8,  0, 19, 10, 11,  9, 10,  6,  0, 20, 12,  7, 14])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">array([False,  True, False,  True, False, False, False,  True, False,</span>
<span class="go">        True,  True, False,  True, False, False], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_from_a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="c"># or,  a[a%3==0]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">extract_from_a</span>           <span class="c"># extract a sub-array with the mask</span>
<span class="go">array([ 3,  0,  9,  6,  0, 12])</span>
</pre></div>
</div>
<p>Indexing with a mask can be very useful to assign a new value to a sub-array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([10, -1,  8, -1, 19, 10, 11, -1, 10, -1, -1, 20, -1,  7, 14])</span>
</pre></div>
</div>
</div>
<div class="section" id="indexing-with-an-array-of-integers">
<h4><a class="toc-backref" href="#id12">Indexing with an array of integers</a><a class="headerlink" href="#indexing-with-an-array-of-integers" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">3</span> <span class="c"># to avoid having always the same np.arange(10)...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([ 3,  1,  5,  3,  7,  5,  9,  7, 11,  9])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">]]</span> <span class="c"># or, a[np.array([2, 5, 1, 8])]</span>
<span class="go">array([ 5,  5,  1, 11])</span>
</pre></div>
</div>
<p>Indexing can be done with an array of integers, where the same index is repeated
several time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>  <span class="c"># note: [2, 3, 2, 4, 2] is a Python list</span>
<span class="go">array([5, 3, 5, 7, 5])</span>
</pre></div>
</div>
<p>New values can be assigned with this kind of indexing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  3,   1,   5,   3,   7,   5,   9, -10,  11, -10])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([  3,   1,   6,   4,   8,   5,   9, -10,  11, -10])</span>
</pre></div>
</div>
<p>When a new array is created by indexing with an array of integers, the new array
has the same shape than the array of integers:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="go">array([[3, 4],</span>
<span class="go">       [9, 7]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  1,  2,  3],</span>
<span class="go">       [ 4,  5,  6,  7],</span>
<span class="go">       [ 8,  9, 10, 11]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
<span class="go">array([ 2,  5,  7, 11])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span>
<span class="go">array([[0, 1],</span>
<span class="go">       [1, 2]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span>
<span class="go">array([[2, 1],</span>
<span class="go">       [3, 3]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
<span class="go">array([[ 2,  5],</span>
<span class="go">       [ 7, 11]])</span>
</pre></div>
</div>
<img alt="../../_images/numpy_fancy_indexing.png" class="align-center" src="../../_images/numpy_fancy_indexing.png" style="width: 100%;" />
<p>We can even use fancy indexing and broadcasting at the same time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  1,  2,  3],</span>
<span class="go">       [ 4,  5,  6,  7],</span>
<span class="go">       [ 8,  9, 10, 11]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c"># same as a[i, 2*np.ones((2,2), dtype=int)]</span>
<span class="go">array([[ 2,  6],</span>
<span class="go">       [ 6, 10]])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="numerical-operations-on-arrays">
<h2><a class="toc-backref" href="#id13">Numerical operations on arrays</a><a class="headerlink" href="#numerical-operations-on-arrays" title="Permalink to this headline">¶</a></h2>
<div class="section" id="elementwise-operations">
<h3><a class="toc-backref" href="#id14">Elementwise operations</a><a class="headerlink" href="#elementwise-operations" title="Permalink to this headline">¶</a></h3>
<p>With scalars:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="mi">1</span>
<span class="go">array([2, 3, 4, 5])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="n">a</span>
<span class="go">array([ 2,  4,  8, 16])</span>
</pre></div>
</div>
<p>All arithmetic operates elementwise:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
<span class="go">array([-1.,  0.,  1.,  2.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
<span class="go">array([ 2.,  4.,  6.,  8.])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">j</span>
<span class="go">array([ 2,  3,  6, 13, 28])</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><strong>Array multiplication is not matrix multiplication:</strong></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">*</span> <span class="n">c</span>                   <span class="c"># NOT matrix multiplication!</span>
<span class="go">array([[ 1.,  1.,  1.],</span>
<span class="go">    [ 1.,  1.,  1.],</span>
<span class="go">    [ 1.,  1.,  1.]])</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Matrix multiplication:</strong></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="go">array([[ 3.,  3.,  3.],</span>
<span class="go">       [ 3.,  3.,  3.],</span>
<span class="go">       [ 3.,  3.,  3.]])</span>
</pre></div>
</div>
</div>
<p>Comparisons:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
<span class="go">array([False,  True, False,  True], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span>
<span class="go">array([False, False,  True, False], dtype=bool)</span>
</pre></div>
</div>
<p>Logical operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="go">array([ True,  True,  True, False], dtype=bool)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="go">array([ True, False, False, False], dtype=bool)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For arrays: &#8220;<tt class="docutils literal"><span class="pre">np.logical_and</span></tt>&#8221; and &#8220;<tt class="docutils literal"><span class="pre">np.logical_or</span></tt>&#8221; for logical
operations, not &#8220;<tt class="docutils literal"><span class="pre">and</span></tt>&#8221; and &#8220;<tt class="docutils literal"><span class="pre">or</span></tt>&#8221;.</p>
</div>
<p>Shape mismatches:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([1, 2, 3, 4])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">ValueError: shape mismatch</span>: <span class="n">objects cannot be broadcast to a single shape</span>
</pre></div>
</div>
<p><strong>&#8216;Broadcast&#8217;?</strong> We&#8217;ll return to that later.</p>
<p><strong>Transposition</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>   <span class="c"># see help(np.triu)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0.,  1.,  1.],</span>
<span class="go">    [ 0.,  0.,  1.],</span>
<span class="go">    [ 0.,  0.,  0.]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<span class="go">array([[ 0.,  0.,  0.],</span>
<span class="go">       [ 1.,  0.,  0.],</span>
<span class="go">       [ 1.,  1.,  0.]])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><strong>Linear algebra</strong></p>
<p class="last">The sub-module <tt class="xref py py-obj docutils literal"><span class="pre">np.linalg</span></tt> implements basic linear algebra, such as
eigenvalue decomposition, solving linear systems... However, it is
not garantied to be compiled using efficient routines, and thus we
recommend to use <tt class="xref py py-obj docutils literal"><span class="pre">scipy.linalg</span></tt>, as detailed in section
<a class="reference internal" href="../scipy.html#scipy-linalg"><em>Linear algebra operations: scipy.linalg</em></a></p>
</div>
<div class="green topic">
<p class="topic-title first">Exercice</p>
<p>Generate arrays <tt class="xref py py-obj docutils literal"><span class="pre">[2**0,</span> <span class="pre">2**1,</span> <span class="pre">2**2,</span> <span class="pre">2**3,</span> <span class="pre">2**4]</span></tt> and
<tt class="xref py py-obj docutils literal"><span class="pre">a_j</span> <span class="pre">=</span> <span class="pre">2^(3*j)</span> <span class="pre">-</span> <span class="pre">j</span></tt></p>
</div>
</div>
<div class="section" id="basic-reductions">
<h3><a class="toc-backref" href="#id15">Basic reductions</a><a class="headerlink" href="#basic-reductions" title="Permalink to this headline">¶</a></h3>
<p>Computing sums:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">10</span>
</pre></div>
</div>
<img alt="../../_images/reductions.png" class="align-right" src="../../_images/reductions.png" />
<p>Sum by rows and by columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">array([[1, 1],</span>
<span class="go">    [2, 2]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>   <span class="c"># columns (first dimension)</span>
<span class="go">array([3, 3])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">(3, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   <span class="c"># rows (second dimension)</span>
<span class="go">array([2, 4])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">(2, 4)</span>
</pre></div>
</div>
<p>Same idea in higher dimensions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="go">1.1600112273698793</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="go">1.1600112273698793</span>
</pre></div>
</div>
<p><strong>Other reductions</strong> &#8212; works the same way (and take <tt class="docutils literal"><span class="pre">axis=</span></tt>)</p>
<ul>
<li><p class="first">Statistics:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="go">1.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="go">1.5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c"># last axis</span>
<span class="go">array([ 2.,  5.])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>          <span class="c"># full population standard dev.</span>
<span class="go">0.82915619758884995</span>
</pre></div>
</div>
</li>
<li><p class="first">Extrema:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="go">3</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c"># index of minimum</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>  <span class="c"># index of maximum</span>
<span class="go">1</span>
</pre></div>
</div>
</li>
<li><p class="first">Logical operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">([</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Can be used for array comparisons:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">a</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="last highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">((</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;=</span> <span class="n">c</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="go">True</span>
</pre></div>
</div>
</div>
</li>
<li><p class="first">... and many more (best to learn as you go).</p>
</li>
</ul>
<div class="topic">
<p class="topic-title first">Example: data statistics</p>
<p>Data in <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>
describes the populations of hares and lynxes (and carrots) in northern
Canada during 20 years.</p>
<p>We can first plot the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;../../data/populations.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># trick: columns to variables</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_4.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_4.png" src="../../_images/numpy_intro_4.png" />
<p>The mean populations over time:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 34080.95238095,  20166.66666667,  42400.        ])</span>
</pre></div>
</div>
<p>The sample standard deviations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">array([ 20897.90645809,  16254.59153691,   3322.50622558])</span>
</pre></div>
</div>
<p>Which species has the highest population each year?</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">populations</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="go">array([2, 2, 0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 0, 0, 0, 1, 2, 2, 2, 2, 2])</span>
</pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">Example: diffusion simulation using a random walk algorithm</p>
<img alt="../../_images/random_walk.png" class="align-center" src="../../_images/random_walk.png" />
<p>What is the typical distance from the origin of a random walker after
<tt class="docutils literal"><span class="pre">t</span></tt> left or right jumps?</p>
<img alt="../../_images/random_walk_schema.png" class="align-center" src="../../_images/random_walk_schema.png" style="width: 100%;" />
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n_stories</span> <span class="o">=</span> <span class="mi">1000</span> <span class="c"># number of walkers</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t_max</span> <span class="o">=</span> <span class="mi">200</span>      <span class="c"># time during which we follow the walker</span>
</pre></div>
</div>
<p>We randomly choose all the steps 1 or -1 of the walk</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t_max</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">steps</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_stories</span><span class="p">,</span> <span class="n">t_max</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span> <span class="c"># Verification: all steps are 1 or -1</span>
<span class="go">array([-1,  1])</span>
</pre></div>
</div>
<p>We build the walks by summing steps along the time</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c"># axis = 1: dimension of time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sq_distance</span> <span class="o">=</span> <span class="n">positions</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
<p>We get the mean in the axis of the stories</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mean_sq_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sq_distance</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_sq_distance</span><span class="p">),</span> <span class="s">&#39;g.&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;y-&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">r&quot;$t$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">r&quot;$\sqrt{\langle (\delta x)^2 \rangle}$&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_5.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_5.png" src="../../_images/numpy_intro_5.png" />
</div>
<p>The RMS distance grows as the square root of the time!</p>
</div>
<div class="section" id="broadcasting">
<h3><a class="toc-backref" href="#id16">Broadcasting</a><a class="headerlink" href="#broadcasting" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Basic operations on <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays (addition, etc.) are elementwise</p>
</li>
<li><p class="first">This works on arrays of the same size.</p>
<blockquote>
<div><div class="line-block">
<div class="line"><strong>Nevertheless</strong>, It&#8217;s also possible to do operations on arrays of different</div>
<div class="line">sizes if <em>Numpy</em> can transform these arrays so that they all have</div>
<div class="line">the same size: this conversion is called <strong>broadcasting</strong>.</div>
</div>
</div></blockquote>
</li>
</ul>
<p>The image below gives an example of broadcasting:</p>
<img alt="../../_images/numpy_broadcasting.png" class="align-center" src="../../_images/numpy_broadcasting.png" style="width: 100%;" />
<p>Let&#8217;s verify:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0,  0,  0],</span>
<span class="go">       [10, 10, 10],</span>
<span class="go">       [20, 20, 20],</span>
<span class="go">       [30, 30, 30]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="go">array([[ 0,  1,  2],</span>
<span class="go">       [10, 11, 12],</span>
<span class="go">       [20, 21, 22],</span>
<span class="go">       [30, 31, 32]])</span>
</pre></div>
</div>
<p>An useful trick:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>  <span class="c"># adds a new axis -&gt; 2D array</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0],</span>
<span class="go">       [10],</span>
<span class="go">       [20],</span>
<span class="go">       [30]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="go">array([[ 0,  1,  2],</span>
<span class="go">       [10, 11, 12],</span>
<span class="go">       [20, 21, 22],</span>
<span class="go">       [30, 31, 32]])</span>
</pre></div>
</div>
<p>We have already used broadcasting without knowing it!:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c"># we assign an array of dimension 0 to an array of dimension 1</span>
<span class="go">array([[ 2.,  2.,  2.,  2.,  2.],</span>
<span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.,  1.,  1.],</span>
<span class="go">       [ 1.,  1.,  1.,  1.,  1.]])</span>
</pre></div>
</div>
<p>Broadcasting seems a bit magical, but it is actually quite natural to use it
when we want to solve a problem whose output data is an array with more
dimensions than input data.</p>
<div class="topic">
<p class="topic-title first">Example</p>
<p>Let&#8217;s construct an array of distances (in miles) between cities of
Route 66: Chicago, Springfield, Saint-Louis, Tulsa, Oklahoma City,
Amarillo, Santa Fe, Albuquerque, Flagstaff and Los Angeles.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mileposts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">198</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">871</span><span class="p">,</span> <span class="mi">1175</span><span class="p">,</span> <span class="mi">1475</span><span class="p">,</span> <span class="mi">1544</span><span class="p">,</span>
<span class="gp">... </span>       <span class="mi">1913</span><span class="p">,</span> <span class="mi">2448</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mileposts</span> <span class="o">-</span> <span class="n">mileposts</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance_array</span>
<span class="go">array([[   0,  198,  303,  736,  871, 1175, 1475, 1544, 1913, 2448],</span>
<span class="go">       [ 198,    0,  105,  538,  673,  977, 1277, 1346, 1715, 2250],</span>
<span class="go">       [ 303,  105,    0,  433,  568,  872, 1172, 1241, 1610, 2145],</span>
<span class="go">       [ 736,  538,  433,    0,  135,  439,  739,  808, 1177, 1712],</span>
<span class="go">       [ 871,  673,  568,  135,    0,  304,  604,  673, 1042, 1577],</span>
<span class="go">       [1175,  977,  872,  439,  304,    0,  300,  369,  738, 1273],</span>
<span class="go">       [1475, 1277, 1172,  739,  604,  300,    0,   69,  438,  973],</span>
<span class="go">       [1544, 1346, 1241,  808,  673,  369,   69,    0,  369,  904],</span>
<span class="go">       [1913, 1715, 1610, 1177, 1042,  738,  438,  369,    0,  535],</span>
<span class="go">       [2448, 2250, 2145, 1712, 1577, 1273,  973,  904,  535,    0]])</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/route66.png"><img alt="../../_images/route66.png" class="align-center" src="../../_images/route66.png" style="width: 342.0px; height: 210.0px;" /></a>
</div>
<div class="topic">
<p class="topic-title first">Good practices</p>
<ul>
<li><p class="first">Explicit variable names (no need of a comment to explain what is in
the variable)</p>
</li>
<li><p class="first">Style: spaces after commas, around <tt class="docutils literal"><span class="pre">=</span></tt>, etc.</p>
<p>A certain number of rules for writing &#8220;beautiful&#8221; code (and, more
importantly, using the same conventions as everybody else!) are
given in the <a class="reference external" href="http://www.python.org/dev/peps/pep-0008">Style Guide for Python Code</a> and the <a class="reference external" href="http://www.python.org/dev/peps/pep-0257">Docstring
Conventions</a> page (to
manage help strings).</p>
</li>
<li><p class="first">Except some rare cases, variable names and comments in English.</p>
</li>
</ul>
</div>
<p>A lot of grid-based or network-based problems can also use
broadcasting. For instance, if we want to compute the distance from
the origin of points on a 10x10 grid, we can do:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span>
<span class="go">array([[ 0.        ,  1.        ,  2.        ,  3.        ,  4.        ],</span>
<span class="go">       [ 1.        ,  1.41421356,  2.23606798,  3.16227766,  4.12310563],</span>
<span class="go">       [ 2.        ,  2.23606798,  2.82842712,  3.60555128,  4.47213595],</span>
<span class="go">       [ 3.        ,  3.16227766,  3.60555128,  4.24264069,  5.        ],</span>
<span class="go">       [ 4.        ,  4.12310563,  4.47213595,  5.        ,  5.65685425]])</span>
</pre></div>
</div>
<p>Or in color:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;equal&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c"># &lt;-- again, not needed in interactive Python</span>
</pre></div>
</div>
</div></blockquote>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_6.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_6.png" src="../../_images/numpy_intro_6.png" />
<p><strong>Remark</strong> : the <tt class="docutils literal"><span class="pre">numpy.ogrid</span></tt> function allows to directly create vectors x
and y of the previous example, with two &#8220;significant dimensions&#8221;:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span>
<span class="go">(array([[0],</span>
<span class="go">       [1],</span>
<span class="go">       [2],</span>
<span class="go">       [3],</span>
<span class="go">       [4]]), array([[0, 1, 2, 3, 4]]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<span class="go">((5, 1), (1, 5))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">y</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>So, <tt class="docutils literal"><span class="pre">np.ogrid</span></tt> is very useful as soon as we have to handle computations on a
grid. On the other hand, <tt class="docutils literal"><span class="pre">np.mgrid</span></tt> directly provides matrices full of
indices for cases where we can&#8217;t (or don&#8217;t want to) benefit from broadcasting:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">array([[0, 0, 0, 0],</span>
<span class="go">       [1, 1, 1, 1],</span>
<span class="go">       [2, 2, 2, 2],</span>
<span class="go">       [3, 3, 3, 3]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">array([[0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3],</span>
<span class="go">       [0, 1, 2, 3]])</span>
</pre></div>
</div>
<p>However, in practice, this is rarely needed!</p>
</div>
<div class="section" id="array-shape-manipulation">
<h3><a class="toc-backref" href="#id17">Array shape manipulation</a><a class="headerlink" href="#array-shape-manipulation" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Flattening</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="go">array([1, 2, 3, 4, 5, 6])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span>
<span class="go">array([[1, 4],</span>
<span class="go">       [2, 5],</span>
<span class="go">       [3, 6]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="go">array([1, 4, 2, 5, 3, 6])</span>
</pre></div>
</div>
<p>Higher dimensions: last dimensions ravel out &#8220;first&#8221;.</p>
<p class="rubric">Reshaping</p>
<p>The inverse operation to flattening:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(2, 3)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="go">array([[1, 2, 3],</span>
<span class="go">       [4, 5, 6]])</span>
</pre></div>
</div>
<p>Creating an array with a different shape, from another array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([[ 0,  1,  2,  3,  4,  5],</span>
<span class="go">       [ 6,  7,  8,  9, 10, 11],</span>
<span class="go">       [12, 13, 14, 15, 16, 17],</span>
<span class="go">       [18, 19, 20, 21, 22, 23],</span>
<span class="go">       [24, 25, 26, 27, 28, 29],</span>
<span class="go">       [30, 31, 32, 33, 34, 35]])</span>
</pre></div>
</div>
<p>Or,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>    <span class="c"># unspecified (-1) value is inferred</span>
</pre></div>
</div>
<p class="rubric">Views and copies</p>
<p><tt class="docutils literal"><span class="pre">ndarray.reshape</span></tt> <strong>may</strong> return a view (cf <tt class="docutils literal"><span class="pre">help(np.reshape)</span></tt>)),
not a copy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">99</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([99,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,</span>
<span class="go">       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,</span>
<span class="go">       34, 35])</span>
</pre></div>
</div>
<p>Beware!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[ 0.,  0.],</span>
<span class="go">       [ 0.,  0.],</span>
<span class="go">       [ 0.,  0.]])</span>
</pre></div>
</div>
<p>To understand, see &#8220;Under the hood&#8221; below.</p>
<p class="rubric">Dimension shuffling</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(4, 3, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(3, 2, 4)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="go">5</span>
</pre></div>
</div>
<p>Also creates a view:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="go">-1</span>
</pre></div>
</div>
<p class="rubric">Resizing</p>
<p>Size of an array can be changed with <tt class="docutils literal"><span class="pre">ndarray.resize</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">8</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([0, 1, 2, 3, 0, 0, 0, 0])</span>
</pre></div>
</div>
<p>However, it must not be referred to somewhere else:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">4</span><span class="p">,))</span>
<span class="gp">...</span>
<span class="go">ValueError: cannot resize an array references or is referenced</span>
<span class="go">by another array in this way.  Use the resize function</span>
</pre></div>
</div>
<p class="rubric">Some examples of real-world use cases</p>
<div class="topic">
<p class="topic-title first">Case 2.a: Calling (legacy) Fortran code</p>
<p>Shape-preserving functions with elementwise non-Python
routines. For instance, Fortran</p>
<div class="highlight-fortran"><div class="highlight"><pre><span class="c">! 2_a_fortran_module.f90</span>
<span class="k">subroutine </span><span class="nv">some_function</span><span class="p">(</span><span class="nv">n</span><span class="p">,</span> <span class="nv">a</span><span class="p">,</span> <span class="nv">b</span><span class="p">)</span>
  <span class="kt">integer</span> <span class="kd">::</span> <span class="nv">n</span>
  <span class="kt">double precision</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">in</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">a</span>
  <span class="kt">double precision</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(</span><span class="nv">n</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="nv">out</span><span class="p">)</span> <span class="kd">::</span> <span class="nv">b</span>
  <span class="nv">b</span> <span class="o">=</span> <span class="nv">a</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">end subroutine </span><span class="nv">some_function</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">f2py</span> <span class="pre">-c</span> <span class="pre">-m</span> <span class="pre">fortran_module</span> <span class="pre">2_a_fortran_module.f90</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">fortran_module</span>

<span class="k">def</span> <span class="nf">some_function</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Call a Fortran routine, and preserve input shape</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="c"># fortran_module.some_function() takes 1-D arrays!</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">fortran_module</span><span class="o">.</span><span class="n">some_function</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">input</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="k">print</span> <span class="n">some_function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]))</span>
<span class="k">print</span> <span class="n">some_function</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]))</span>

<span class="c"># -&gt;</span>
<span class="c"># [ 2.  3.  4.]</span>
<span class="c"># [[ 2.  3.]</span>
<span class="c">#  [ 4.  5.]]</span>
</pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">Case 2.b: Block matrices and vectors (and tensors)</p>
<p>Vector space: quantum level <img class="math" src="../../_images/math/b88c462e5d9319a7d2181ad94863658fa0a24736.png" alt="\otimes" style="vertical-align: -3px"/> spin</p>
<div class="math">
<p><img src="../../_images/math/d08f2718c597cbba158a44a4fc825136bec60a69.png" alt="\check{\psi}
=
\begin{pmatrix}
\hat{\psi}_1 \\ \hat{\psi}_2
\end{pmatrix}
\,,
\qquad
\hat{\psi}_{1} =
\begin{pmatrix}
  \psi_{1\uparrow} \\ \psi_{1\downarrow}
\end{pmatrix}
\qquad
\hat{\psi}_{2} =
\begin{pmatrix}
  \psi_{2\uparrow} \\ \psi_{2\downarrow}
\end{pmatrix}"/></p>
</div><p>In short: for <strong>block matrices and vectors</strong>, it can be useful
to preserve the <strong>block structure</strong>.</p>
<p>In Numpy:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>   <span class="c"># dimensions: level, spin</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="c"># &lt;-- psi_{1,downarrow}</span>
</pre></div>
</div>
<p>Linear operators on such block vectors have similar block structure:</p>
<div class="math">
<p><img src="../../_images/math/e6fa373bfd92f7d3e8f9543fea328d3240254df1.png" alt="\check{H} = \begin{pmatrix}
\hat{h}_{11} &amp; \hat{V} \\
\hat{V}^\dagger &amp; \hat{h}_{22} \\
\end{pmatrix}
\,,
\qquad
\hat{h}_{11}
=
\begin{pmatrix}
\epsilon_{1,\uparrow}
&amp; 0
\\
0 &amp; \epsilon_{1,\downarrow}
\end{pmatrix}
\,,
\qquad
\ldots"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="c"># dimensions: level1, level2, spin1, spin2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">h_11</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">V</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Doing the matrix product: get rid of the block structure, do the
4x4 matrix product, then put it back</p>
<div class="math">
<p><img src="../../_images/math/ea2a09651649a8aba90002fa152b91e59ff3c1d7.png" alt="\check{H}\check{\psi}"/></p>
</div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">mdot</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">psi</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">operator</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
<span class="gp">... </span>               <span class="n">psi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>I.e., reorder dimensions first to <tt class="docutils literal"><span class="pre">level1,</span> <span class="pre">spin1,</span> <span class="pre">level2,</span> <span class="pre">spin2</span></tt>
and then reshape =&gt; correct matrix product.</p>
</div>
</div>
<div class="section" id="sorting-data">
<h3><a class="toc-backref" href="#id18">Sorting data</a><a class="headerlink" href="#sorting-data" title="Permalink to this headline">¶</a></h3>
<p>Sorting along an axis:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([[3, 4, 5],</span>
<span class="go">       [1, 1, 2]])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Sorts each row separately!</p>
</div>
<p>In-place sort:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([[3, 4, 5],</span>
<span class="go">       [1, 1, 2]])</span>
</pre></div>
</div>
<p>Sorting with fancy indexing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">array([2, 3, 1, 0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="go">array([1, 2, 3, 4])</span>
</pre></div>
</div>
<p>Finding minima and maxima:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">j_max</span><span class="p">,</span> <span class="n">j_min</span>
<span class="go">(0, 2)</span>
</pre></div>
</div>
</div>
<div class="section" id="some-excercices">
<h3><a class="toc-backref" href="#id19">Some excercices</a><a class="headerlink" href="#some-excercices" title="Permalink to this headline">¶</a></h3>
<div class="topic">
<p class="topic-title first">Worked example: Framing Lena</p>
<p>Let&#8217;s do some manipulations on numpy arrays by starting with the
famous image of Lena (<a class="reference external" href="http://www.cs.cmu.edu/~chuck/lennapg/">http://www.cs.cmu.edu/~chuck/lennapg/</a>).
<tt class="docutils literal"><span class="pre">scipy</span></tt> provides a 2D array of this image with the <tt class="docutils literal"><span class="pre">scipy.lena</span></tt>
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">misc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
</pre></div>
</div>
<p>Here are a few images we will be able to obtain with our manipulations:
use different colormaps, crop the image, change some parts of the image.</p>
<img alt="../../_images/lenas.png" class="align-center" src="../../_images/lenas.png" />
<ul>
<li><p class="first">Let&#8217;s use the imshow function of pylab to display the image.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">In [4]: </span><span class="n">lena</span> <span class="o">=</span> <span class="n">misc</span><span class="o">.</span><span class="n">lena</span><span class="p">()</span>
<span class="gp">In [5]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Lena is then displayed in false colors. A colormap must be
specified for her to be displayed in grey.</p>
</li>
</ul>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">Create an array of the image with a narrower centering : for example,
remove 30 pixels from all the borders of the image. To check the result,
display this new array with <tt class="docutils literal"><span class="pre">imshow</span></tt>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [9]: </span><span class="n">crop_lena</span> <span class="o">=</span> <span class="n">lena</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p class="first">We will now frame Lena&#8217;s face with a black locket. For this, we
need to create a mask corresponding to the pixels we want to be
black. The mask is defined by this condition <tt class="docutils literal"><span class="pre">(y-256)**2</span> <span class="pre">+</span>
<span class="pre">(x-256)**2</span></tt></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">512</span><span class="p">]</span> <span class="c"># x and y indices of pixels</span>
<span class="gp">In [16]: </span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<span class="go">Out[16]: </span><span class="p">((</span><span class="mi">512</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">512</span><span class="p">))</span>
<span class="gp">In [17]: </span><span class="n">centerx</span><span class="p">,</span> <span class="n">centery</span> <span class="o">=</span> <span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="c"># center of the image</span>
<span class="gp">In [18]: </span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">y</span> <span class="o">-</span> <span class="n">centery</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">centerx</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">230</span><span class="o">**</span><span class="mi">2</span> <span class="c"># circle</span>
</pre></div>
</div>
<p>then we assign the value 0 to the pixels of the image corresponding
to the mask. The syntax is extremely simple and intuitive:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [19]: </span><span class="n">lena</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="gp">In [20]: </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lena</span><span class="p">)</span>
<span class="go">Out[20]: </span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">AxesImage</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0xa36534c</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">Follow-up: copy all instructions of this exercise in a script called
<tt class="docutils literal"><span class="pre">lena_locket.py</span></tt> then execute this script in IPython with <tt class="docutils literal"><span class="pre">%run</span>
<span class="pre">lena_locket.py</span></tt>.</p>
<p>Change the circle to an ellipsoid.</p>
</li>
</ul>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Array manipulations</p>
<ol class="arabic">
<li><p class="first">Form the 2-D array (without typing it in explicitly):</p>
<div class="highlight-python"><pre>1  6 11
2  7 12
3  8 13
4  9 14
5 10 15</pre>
</div>
<p>and generate a new array containing its 2nd and 4th rows.</p>
</li>
<li><p class="first">Divide each column of the array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>elementwise with the array <tt class="docutils literal"><span class="pre">b</span> <span class="pre">=</span> <span class="pre">np.array([1.,</span> <span class="pre">5,</span> <span class="pre">10,</span> <span class="pre">15,</span> <span class="pre">20])</span></tt>.
(Hint: <tt class="docutils literal"><span class="pre">np.newaxis</span></tt>).</p>
</li>
<li><p class="first">Harder one: Generate a 10 x 3 array of random numbers (in range [0,1]).
For each row, pick the number closest to 0.5.</p>
<ul class="simple">
<li>Use <tt class="docutils literal"><span class="pre">abs</span></tt> and <tt class="docutils literal"><span class="pre">argsort</span></tt> to find the column <tt class="docutils literal"><span class="pre">j</span></tt> closest for
each row.</li>
<li>Use fancy indexing to extract the numbers.  (Hint: <tt class="docutils literal"><span class="pre">a[i,j]</span></tt> &#8211;
the array <tt class="docutils literal"><span class="pre">i</span></tt> must contain the row numbers corresponding to stuff in
<tt class="docutils literal"><span class="pre">j</span></tt>.)</li>
</ul>
</li>
</ol>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Data statistics</p>
<p>The data in <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>::
describes the populations of hares and lynxes (and carrots) in
northern Canada during 20 years:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;../../data/populations.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">carrots</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>  <span class="c"># trick: columns to variables</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">hares</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">lynxes</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">carrots</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s">&#39;Hare&#39;</span><span class="p">,</span> <span class="s">&#39;Lynx&#39;</span><span class="p">,</span> <span class="s">&#39;Carrot&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_7.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_7.png" src="../../_images/numpy_intro_7.png" />
<p>Computes and print, based on the data in <tt class="docutils literal"><span class="pre">populations.txt</span></tt>...</p>
<ol class="arabic simple">
<li>The mean and std of the populations of each species for the years
in the period.</li>
<li>Which year each species had the largest population.</li>
<li>Which species has the largest population for each year.
(Hint: <tt class="docutils literal"><span class="pre">argsort</span></tt> &amp; fancy indexing of
<tt class="docutils literal"><span class="pre">np.array(['H',</span> <span class="pre">'L',</span> <span class="pre">'C'])</span></tt>)</li>
<li>Which years any of the populations is above 50000.
(Hint: comparisons and <tt class="docutils literal"><span class="pre">np.any</span></tt>)</li>
<li>The top 2 years for each species when they had the lowest
populations. (Hint: <tt class="docutils literal"><span class="pre">argsort</span></tt>, fancy indexing)</li>
<li>Compare (plot) the change in hare population (see
<tt class="docutils literal"><span class="pre">help(np.gradient)</span></tt>) and the number of lynxes. Check correlation
(see <tt class="docutils literal"><span class="pre">help(np.corrcoef)</span></tt>).</li>
</ol>
<p>... all without for-loops.</p>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Crude integral approximations</p>
<p>Write a function <tt class="docutils literal"><span class="pre">f(a,</span> <span class="pre">b,</span> <span class="pre">c)</span></tt> that returns <img class="math" src="../../_images/math/3d7c9694dffca6866113f84e9c6a0980cf8ce047.png" alt="a^b - c" style="vertical-align: 0px"/>.  Form
a 24x12x6 array containing its values in parameter ranges <tt class="docutils literal"><span class="pre">[0,1]</span> <span class="pre">x</span>
<span class="pre">[0,1]</span> <span class="pre">x</span> <span class="pre">[0,1]</span></tt>.</p>
<p>Approximate the 3-d integral</p>
<div class="math">
<p><img src="../../_images/math/7057c0b4df82c2659d776bcdc0eb1c9e16f61f9f.png" alt="\int_0^1\int_0^1\int_0^1(a^b-c)da\,db\,dc"/></p>
</div><p>over this volume with the mean.  The exact result is: <img class="math" src="../../_images/math/13ff2c8691c09121c0bba41558b2ad22e55e077c.png" alt="\ln 2 -
\frac{1}{2}\approx0.1931\ldots" style="vertical-align: -10px"/> &#8212; what is your relative error?</p>
<p>(Hints: use elementwise operations and broadcasting.
You can make <tt class="docutils literal"><span class="pre">np.ogrid</span></tt> give a number of points in given range
with <tt class="docutils literal"><span class="pre">np.ogrid[0:1:20j]</span></tt>.)</p>
<p><strong>Reminder</strong> Python functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">some_result</span>
</pre></div>
</div>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Mandelbrot set</p>
<blockquote>
<div><p>Write a script that computes the Mandelbrot fractal. The Mandelbrot
iteration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">N_max</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">some_threshold</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">y</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N_max</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span>
</pre></div>
</div>
<p>Point (x, y) belongs to the Mandelbrot set if <img class="math" src="../../_images/math/ee71b080efbd8d38394b4e41eeb0b02b750ecfed.png" alt="|c|" style="vertical-align: -7px"/> &lt;
<tt class="docutils literal"><span class="pre">some_threshold</span></tt>.</p>
<p>Do this computation by:</p>
<ol class="arabic">
<li><p class="first">Construct a grid of c = x + 1j*y values in range [-2, 1] x [-1.5, 1.5]</p>
</li>
<li><p class="first">Do the iteration</p>
</li>
<li><p class="first">Form the 2-d boolean mask indicating which points are in the set</p>
</li>
<li><p class="first">Save the result to an image with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mandelbrot.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="green topic">
<p class="topic-title first">Exercise: Markov chain</p>
<blockquote>
<div><img alt="../../_images/markov-chain.png" src="../../_images/markov-chain.png" />
<p>Markov chain transition matrix <tt class="docutils literal"><span class="pre">P</span></tt>, and probability distribution on
the states <tt class="docutils literal"><span class="pre">p</span></tt>:</p>
<ol class="arabic simple">
<li><tt class="docutils literal"><span class="pre">0</span> <span class="pre">&lt;=</span> <span class="pre">P[i,j]</span> <span class="pre">&lt;=</span> <span class="pre">1</span></tt>: probability to go from state <tt class="docutils literal"><span class="pre">i</span></tt> to state <tt class="docutils literal"><span class="pre">j</span></tt></li>
<li>Transition rule: <img class="math" src="../../_images/math/df72f26c7e5032305f8cdafc8cf3385cdc367f19.png" alt="p_{new} = P^T p_{old}" style="vertical-align: -6px"/></li>
<li><tt class="docutils literal"><span class="pre">all(sum(P,</span> <span class="pre">axis=1)</span> <span class="pre">==</span> <span class="pre">1)</span></tt>, <tt class="docutils literal"><span class="pre">p.sum()</span> <span class="pre">==</span> <span class="pre">1</span></tt>: normalization</li>
</ol>
<p>Write a script that works with 5 states, and:</p>
<ul class="simple">
<li>Constructs a random matrix, and normalizes each row so that it
is a transition matrix.</li>
<li>Starts from a random (normalized) probability distribution
<tt class="docutils literal"><span class="pre">p</span></tt> and takes 50 steps =&gt; <tt class="docutils literal"><span class="pre">p_50</span></tt></li>
<li>Computes the stationary distribution: the eigenvector of <tt class="docutils literal"><span class="pre">P.T</span></tt>
with eigenvalue 1 (numerically: closest to 1) =&gt; <tt class="docutils literal"><span class="pre">p_stationary</span></tt></li>
</ul>
<p>Remember to normalize the eigenvector &#8212; I didn&#8217;t...</p>
<ul class="simple">
<li>Checks if <tt class="docutils literal"><span class="pre">p_50</span></tt> and <tt class="docutils literal"><span class="pre">p_stationary</span></tt> are equal to tolerance 1e-5</li>
</ul>
<p>Toolbox: <tt class="docutils literal"><span class="pre">np.random.rand</span></tt>, <tt class="docutils literal"><span class="pre">.dot()</span></tt>, <tt class="docutils literal"><span class="pre">np.linalg.eig</span></tt>,
reductions, <tt class="docutils literal"><span class="pre">abs()</span></tt>, <tt class="docutils literal"><span class="pre">argmin</span></tt>, comparisons, <tt class="docutils literal"><span class="pre">all</span></tt>,
<tt class="docutils literal"><span class="pre">np.linalg.norm</span></tt>, etc.</p>
</div></blockquote>
</div>
</div>
<div class="section" id="summary">
<h3><a class="toc-backref" href="#id20">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p><strong>What do you need to know to get started?</strong></p>
<ul>
<li><p class="first">Know how to create arrays : <tt class="docutils literal"><span class="pre">array</span></tt>, <tt class="docutils literal"><span class="pre">arange</span></tt>, <tt class="docutils literal"><span class="pre">ones</span></tt>,
<tt class="docutils literal"><span class="pre">zeros</span></tt>.</p>
</li>
<li><p class="first">Know the shape of the array with <tt class="docutils literal"><span class="pre">array.shape</span></tt>, then use slicing
to obtain different views of the array: <tt class="docutils literal"><span class="pre">array[::2]</span></tt>,
etc. Adjust the shape of the array using <tt class="docutils literal"><span class="pre">reshape</span></tt> or flatten it
with <tt class="docutils literal"><span class="pre">ravel</span></tt>.</p>
</li>
<li><p class="first">Obtain a subset of the elements of an array and/or modify their values
with masks:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</li>
<li><p class="first">Know miscellaneous operations on arrays, such as finding the mean or max
(<tt class="docutils literal"><span class="pre">array.max()</span></tt>, <tt class="docutils literal"><span class="pre">array.mean()</span></tt>). No need to retain everything, but
have the reflex to search in the documentation (online docs,
<tt class="docutils literal"><span class="pre">help()</span></tt>, <tt class="docutils literal"><span class="pre">lookfor()</span></tt>)!!</p>
</li>
<li><p class="first">For advanced use: master the indexing with arrays of integers, as well as
broadcasting. Know more Numpy functions to handle various array
operations.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="advanced-operations">
<h2><a class="toc-backref" href="#id21">Advanced operations</a><a class="headerlink" href="#advanced-operations" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fourier-transforms">
<h3><a class="toc-backref" href="#id22">Fourier transforms</a><a class="headerlink" href="#fourier-transforms" title="Permalink to this headline">¶</a></h3>
<p>Numpy contains 1-D, 2-D, and N-D fast discrete Fourier transform routines,
which compute:</p>
<div class="math">
<p><img src="../../_images/math/dd1819fee3d9660e590d152f0c7cb7aa0c441ff1.png" alt="A_k =  \sum_{m=0}^{n-1} a_m \exp\left\{-2\pi i{mk \over n}\right\}
\qquad k = 0,\ldots,n-1."/></p>
</div><p>Full details of what for you can use such standard routines is beyond
this tutorial. Neverheless, there they are, if you need them:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">set_printoptions</span><span class="p">(</span><span class="n">suppress</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># print small number as 0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fa</span>
<span class="go">array([ 10.-0.j,   0.+0.j,   0.+0.j,   0.+0.j,   0.+0.j,   0.+0.j,</span>
<span class="go">        -0.+0.j,  -0.+0.j,  -0.+0.j,  -0.+0.j])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">2</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftn</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="go">array([[ 18.-0.j,   0.+0.j,  -0.+0.j],</span>
<span class="go">       [  0.+0.j,   0.+0.j,   0.+0.j],</span>
<span class="go">       [ -0.+0.j,   0.+0.j,   0.+0.j]])</span>
</pre></div>
</div>
<p>See <tt class="docutils literal"><span class="pre">help(np.fft)</span></tt> and <tt class="docutils literal"><span class="pre">help(np.fft.fft)</span></tt> for more.  These
functions in general take the <tt class="docutils literal"><span class="pre">axes</span></tt> argument, and you can
additionally specify padding etc.</p>
<p class="rubric">Worked example: Crude periodicity finding</p>
<p>[<a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity.py">source code</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity_00.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity_00.pdf">pdf</a>]</p>
<img alt="../../_images/4_a_periodicity_00.png" src="../../_images/4_a_periodicity_00.png" />
<p>[<a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity.py">source code</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity_01.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_a_periodicity_01.pdf">pdf</a>]</p>
<img alt="../../_images/4_a_periodicity_01.png" src="../../_images/4_a_periodicity_01.png" />
<p class="rubric">Worked example: Gaussian image blur</p>
<p>Convolution:</p>
<div class="math">
<p><img src="../../_images/math/8a0d820c0f23dceec498bfe04920ac8892044ded.png" alt="f_1(t) = \int dt'\, K(t-t') f_0(t')"/></p>
</div><div class="math">
<p><img src="../../_images/math/6ce1d529b80698bcaf26a9478845e3ba42a83028.png" alt="\tilde{f}_1(\omega) = \tilde{K}(\omega) \tilde{f}_0(\omega)"/></p>
</div><p>[<a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_b_image_blur.py">source code</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_b_image_blur.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/intro/numpy/solutions/4_b_image_blur.pdf">pdf</a>]</p>
<img alt="../../_images/4_b_image_blur.png" src="../../_images/4_b_image_blur.png" />
</div>
<div class="section" id="polynomials">
<h3><a class="toc-backref" href="#id23">Polynomials</a><a class="headerlink" href="#polynomials" title="Permalink to this headline">¶</a></h3>
<p>Numpy also contains polynomials in different bases:</p>
<p>For example, <img class="math" src="../../_images/math/bd885f6169380796b305c4fe192e17830e562606.png" alt="3x^2 + 2x - 1" style="vertical-align: -2px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">-1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">roots</span>
<span class="go">array([-1.        ,  0.33333333])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">order</span>
<span class="go">2</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;-&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_9.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_9.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_9.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_9.png" src="../../_images/numpy_intro_9.png" />
<p>See <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/routines.polynomials.poly1d.html">http://docs.scipy.org/doc/numpy/reference/routines.polynomials.poly1d.html</a>
for more.</p>
<p class="rubric">More polynomials (with more bases)</p>
<p>Numpy also has a more sophisticated polynomial interface, which supports
e.g. the Chebyshev basis.</p>
<p><img class="math" src="../../_images/math/bd885f6169380796b305c4fe192e17830e562606.png" alt="3x^2 + 2x - 1" style="vertical-align: -2px"/></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">Polynomial</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c"># coefs in different order!</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="go">-1.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>
<span class="go">array([-1.        ,  0.33333333])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">order</span>
<span class="go">2</span>
</pre></div>
</div>
<p>Example using polynomials in Chebyshev basis, for polynomials in
range <tt class="docutils literal"><span class="pre">[-1,</span> <span class="pre">1]</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">Chebyshev</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;r.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">p</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_10.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_10.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_10.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_10.png" src="../../_images/numpy_intro_10.png" />
<p>The Chebyshev polynomials have some advantages in interpolation.</p>
</div>
<div class="section" id="summary-exercises">
<h3><a class="toc-backref" href="#id24">Summary &amp; Exercises</a><a class="headerlink" href="#summary-exercises" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>There is a number of data types with different precisions.
In some special cases you may need to care about this.</li>
<li>Structured arrays contain data of a composite type.  Lumping pieces
of data together this way has various possible uses.</li>
<li>Fourier transform routines are under <tt class="docutils literal"><span class="pre">np.fft</span></tt></li>
<li>Masked arrays can be used for missing data</li>
<li>Polynomials are available in various bases</li>
</ul>
</div>
</div>
<div class="section" id="loading-data-files">
<h2><a class="toc-backref" href="#id25">Loading data files</a><a class="headerlink" href="#loading-data-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="text-files">
<h3><a class="toc-backref" href="#id26">Text files</a><a class="headerlink" href="#text-files" title="Permalink to this headline">¶</a></h3>
<p>Example: <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>:</p>
<div class="highlight-python"><pre>1900        30e3    4e3     51300
1901        47.2e3  6.1e3   48200
1902        70.2e3  9.8e3   41500
...</pre>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;populations.txt&#39;</span><span class="p">)</span>    <span class="c"># if in current directory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span>
<span class="go">array([[  1900.,  30000.,   4000.,  51300.],</span>
<span class="go">    [  1901.,  47200.,   6100.,  48200.],</span>
<span class="go">    [  1902.,  70200.,   9800.,  41500.],</span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s">&#39;pop2.txt&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;pop2.txt&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you have a complicated text file, what you can try are:</p>
<ul class="last simple">
<li><tt class="docutils literal"><span class="pre">np.genfromtxt</span></tt></li>
<li>Using Python&#8217;s I/O functions and e.g. regexps for parsing
(Python is quite well suited for this)</li>
</ul>
</div>
<div class="topic">
<p class="topic-title first">Navigating the filesystem with <em>Ipython</em></p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">pwd</span>      <span class="c"># show current directory</span>
<span class="go">&#39;/home/user/stuff/2011-numpy-tutorial&#39;</span>
<span class="gp">In [2]: </span><span class="n">cd</span> <span class="n">ex</span>
<span class="go">&#39;/home/user/stuff/2011-numpy-tutorial/ex&#39;</span>
<span class="gp">In [3]: </span><span class="n">ls</span>
<span class="go">populations.txt  species.txt</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="images">
<h3><a class="toc-backref" href="#id27">Images</a><a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h3>
<p>Using Matplotlib:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;../../data/elephant.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">((200, 300, 3), dtype(&#39;float32&#39;))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;plot.png&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="s">&#39;red_elephant&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
</pre></div>
</div>
<p>This saved only one channel (of RGB):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;red_elephant.png&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Other libraries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">scipy.misc</span> <span class="kn">import</span> <span class="n">imsave</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">imsave</span><span class="p">(</span><span class="s">&#39;tiny_elephant.png&#39;</span><span class="p">,</span> <span class="n">img</span><span class="p">[::</span><span class="mi">6</span><span class="p">,::</span><span class="mi">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s">&#39;tiny_elephant.png&#39;</span><span class="p">),</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_3.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_3.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_3.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_3.png" src="../../_images/numpy_intro_3.png" />
</div>
<div class="section" id="numpy-s-own-format">
<h3><a class="toc-backref" href="#id28">Numpy&#8217;s own format</a><a class="headerlink" href="#numpy-s-own-format" title="Permalink to this headline">¶</a></h3>
<p>Numpy has its own binary format, not portable but with efficient I/O:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;pop.npy&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;pop.npy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="well-known-more-obscure-file-formats">
<h3><a class="toc-backref" href="#id29">Well-known (&amp; more obscure) file formats</a><a class="headerlink" href="#well-known-more-obscure-file-formats" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>HDF5: <a class="reference external" href="http://code.google.com/p/h5py/">h5py</a>, <a class="reference external" href="http://pytables.org">PyTables</a></li>
<li>NetCDF: <tt class="docutils literal"><span class="pre">scipy.io.netcdf_file</span></tt>, <a class="reference external" href="http://code.google.com/p/netcdf4-python/">netcdf4-python</a>, ...</li>
<li>Matlab: <tt class="docutils literal"><span class="pre">scipy.io.loadmat</span></tt>, <tt class="docutils literal"><span class="pre">scipy.io.savemat</span></tt></li>
<li>MatrixMarket: <tt class="docutils literal"><span class="pre">scipy.io.mmread</span></tt>, <tt class="docutils literal"><span class="pre">scipy.io.mmread</span></tt></li>
</ul>
<p>... if somebody uses it, there&#8217;s probably also a Python library for it.</p>
<div class="green topic">
<p class="topic-title first">Exercise: Text data files</p>
<p>Write a Python script that loads data from <a class="reference download internal" href="../../_downloads/populations.txt"><tt class="xref download docutils literal"><span class="pre">populations.txt</span></tt></a>:: and drop the last column and the first
5 rows. Save the smaller dataset to <tt class="docutils literal"><span class="pre">pop2.txt</span></tt>.</p>
</div>
</div>
</div>
<div class="section" id="more-elaborate-arrays">
<h2><a class="toc-backref" href="#id30">More elaborate arrays</a><a class="headerlink" href="#more-elaborate-arrays" title="Permalink to this headline">¶</a></h2>
<div class="section" id="more-data-types">
<h3><a class="toc-backref" href="#id31">More data types</a><a class="headerlink" href="#more-data-types" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Casting</p>
<p>&#8220;Bigger&#8221; type wins in mixed-type operations:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.5</span>
<span class="go">array([ 2.5,  3.5,  4.5])</span>
</pre></div>
</div>
<p>Assignment never changes the type!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.9</span>     <span class="c"># &lt;-- float is truncated to integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">array([1, 2, 3])</span>
</pre></div>
</div>
<p>Forced casts:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c"># &lt;-- truncates to integer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([1, 1, 1])</span>
</pre></div>
</div>
<p>Rounding:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.7</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>                    <span class="c"># still floating-point</span>
<span class="go">array([ 2.,  1.,  2.])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([2, 1, 2])</span>
</pre></div>
</div>
<p class="rubric">Different data type sizes</p>
<p>Integers (signed):</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">int8</span></tt></td>
<td>8 bits</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">int16</span></tt></td>
<td>16 bits</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">int32</span></tt></td>
<td>32 bits (same as <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> on 32-bit platform)</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">int64</span></tt></td>
<td>64 bits (same as <tt class="xref py py-class docutils literal"><span class="pre">int</span></tt> on 64-bit platform)</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
<span class="go">dtype(&#39;int64&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span>
<span class="go">(2147483647, 2147483647)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span>
<span class="go">(9223372036854775807, 9223372036854775807L)</span>
</pre></div>
</div>
<p>Unsigned integers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">uint8</span></tt></td>
<td>8 bits</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">uint16</span></tt></td>
<td>16 bits</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">uint32</span></tt></td>
<td>32 bits</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">uint64</span></tt></td>
<td>64 bits</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span>
<span class="go">(2147483647, 2147483647)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">1</span>
<span class="go">(9223372036854775807, 9223372036854775807L)</span>
</pre></div>
</div>
<p>Floating-point numbers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">float16</span></tt></td>
<td>16 bits</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">float32</span></tt></td>
<td>32 bits</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">float64</span></tt></td>
<td>64 bits (same as <tt class="xref py py-class docutils literal"><span class="pre">float</span></tt>)</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">float96</span></tt></td>
<td>96 bits, platform-dependent (same as <tt class="xref py py-class docutils literal"><span class="pre">np.longdouble</span></tt>)</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">float128</span></tt></td>
<td>128 bits, platform-dependent (same as <tt class="xref py py-class docutils literal"><span class="pre">np.longdouble</span></tt>)</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
<span class="go">1.1920929e-07</span>
<span class="gp">&gt;&gt;&gt; </span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
<span class="go">2.2204460492503131e-16</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Complex floating-point numbers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">complex64</span></tt></td>
<td>two 32-bit floats</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">complex128</span></tt></td>
<td>two 64-bit floats</td>
</tr>
<tr class="row-odd"><td><tt class="xref py py-class docutils literal"><span class="pre">complex192</span></tt></td>
<td>two 96-bit floats, platform-dependent</td>
</tr>
<tr class="row-even"><td><tt class="xref py py-class docutils literal"><span class="pre">complex256</span></tt></td>
<td>two 128-bit floats, platform-dependent</td>
</tr>
</tbody>
</table>
<div class="topic">
<p class="topic-title first">Smaller data types</p>
<p>If you don&#8217;t know you need special data types, then you probably don&#8217;t.</p>
<p>Comparison on using <tt class="docutils literal"><span class="pre">float32</span></tt> instead of <tt class="docutils literal"><span class="pre">float64</span></tt>:</p>
<ul>
<li><p class="first">Half the size in memory and on disk</p>
</li>
<li><p class="first">Half the memory bandwidth required (may be a bit faster in some operations)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mf">1e6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

<span class="gp">In [2]: </span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mf">1e6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="gp">In [3]: </span><span class="o">%</span><span class="n">timeit</span> <span class="n">a</span><span class="o">*</span><span class="n">a</span>
<span class="go">1000 loops, best of 3: 1.78 ms per loop</span>

<span class="gp">In [4]: </span><span class="o">%</span><span class="n">timeit</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span>
<span class="go">1000 loops, best of 3: 1.07 ms per loop</span>
</pre></div>
</div>
</li>
<li><p class="first">But: bigger rounding errors &#8212; sometimes in surprising places
(i.e., don&#8217;t use them unless you really need them)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="structured-data-types">
<h3><a class="toc-backref" href="#id32">Structured data types</a><a class="headerlink" href="#structured-data-types" title="Permalink to this headline">¶</a></h3>
<p class="rubric">Composite data types</p>
<table border="1" class="docutils">
<colgroup>
<col width="95%" />
<col width="5%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">sensor_code</span></tt> (4-character string)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">position</span></tt> (float)</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">value</span></tt> (float)</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;sensor_code&#39;</span><span class="p">,</span> <span class="s">&#39;S4&#39;</span><span class="p">),</span>
<span class="gp">... </span>                                <span class="p">(</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="o">.</span><span class="n">ndim</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(6,)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span>
<span class="go">(&#39;sensor_code&#39;, &#39;position&#39;, &#39;value&#39;)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;BETA&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;TAU&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">),</span>
<span class="gp">... </span>              <span class="p">(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;ALFA&#39;</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;TAU&#39;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span>
<span class="go">array([(&#39;ALFA&#39;, 1.0, 0.35), (&#39;BETA&#39;, 1.0, 0.11), (&#39;TAU&#39;, 1.0, 0.39),</span>
<span class="go">       (&#39;ALFA&#39;, 1.5, 0.35), (&#39;ALFA&#39;, 2.1, 0.11), (&#39;TAU&#39;, 1.2, 0.39)],</span>
<span class="go">      dtype=[(&#39;sensor_code&#39;, &#39;|S4&#39;), (&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])</span>
</pre></div>
</div>
<p>Field access works by indexing with field names:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span>
<span class="go">array([&#39;ALFA&#39;, &#39;BETA&#39;, &#39;TAU&#39;, &#39;ALFA&#39;, &#39;ALFA&#39;, &#39;TAU&#39;],</span>
<span class="go">      dtype=&#39;|S4&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="s">&#39;value&#39;</span><span class="p">]</span>
<span class="go">array([ 0.35,  0.11,  0.39,  0.35,  0.11,  0.39])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(&#39;ALFA&#39;, 1.0, 0.35)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;TAU&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">(&#39;TAU&#39;, 1.0, 0.35)</span>
</pre></div>
</div>
<p>Multiple fields at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[[</span><span class="s">&#39;position&#39;</span><span class="p">,</span> <span class="s">&#39;value&#39;</span><span class="p">]]</span>
<span class="go">array([(1.0, 0.35), (1.0, 0.11), (1.0, 0.39), (1.5, 0.35), (2.1, 0.11),</span>
<span class="go">       (1.2, 0.39)],</span>
<span class="go">      dtype=[(&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])</span>
</pre></div>
</div>
<p>Fancy indexing works, as usually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">samples</span><span class="p">[</span><span class="n">samples</span><span class="p">[</span><span class="s">&#39;sensor_code&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;ALFA&#39;</span><span class="p">]</span>
<span class="go">array([(&#39;ALFA&#39;, 1.0, 0.35), (&#39;ALFA&#39;, 1.5, 0.35), (&#39;ALFA&#39;, 2.1, 0.11)],</span>
<span class="go">      dtype=[(&#39;sensor_code&#39;, &#39;|S4&#39;), (&#39;position&#39;, &#39;&lt;f8&#39;), (&#39;value&#39;, &#39;&lt;f8&#39;)])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There are a bunch of other syntaxes for constructing structured
arrays, see <a class="reference external" href="http://docs.scipy.org/doc/numpy/user/basics.rec.html">here</a>
and <a class="reference external" href="http://docs.scipy.org/doc/numpy/reference/arrays.dtypes.html#specifying-and-constructing-data-types">here</a>.</p>
</div>
</div>
<div class="section" id="masked-arrays">
<h3><a class="toc-backref" href="#id33">Masked arrays</a><a class="headerlink" href="#masked-arrays" title="Permalink to this headline">¶</a></h3>
<p>Masked arrays are arrays that may have missing or invalid entries.</p>
<p>For example, suppose we have an array where the fourth entry is invalid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<p>One way to describe this is to create a masked array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<span class="go">masked_array(data = [1 2 3 -- 5],</span>
<span class="go">             mask = [False False False  True False],</span>
<span class="go">       fill_value = 999999)</span>
</pre></div>
</div>
<p>Masked mean ignores masked data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="go">2.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mx</span><span class="p">)</span>
<span class="go">2.75</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Not all Numpy functions respect masks, for instance
<tt class="docutils literal"><span class="pre">np.dot</span></tt>, so check the return types.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">masked_array</span></tt> returns a <strong>view</strong> to the original array:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">array([  1,   9,   3, -99,   5])</span>
</pre></div>
</div>
<p class="rubric">The mask</p>
<p>You can modify the mask by assigning:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<span class="go">masked_array(data = [1 -- 3 -- 5],</span>
<span class="go">            mask = [False  True False  True False],</span>
<span class="go">    fill_value = 999999)</span>
</pre></div>
</div>
<p>The mask is cleared on assignment:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<span class="go">masked_array(data = [1 9 3 -- 5],</span>
<span class="go">            mask = [False False False  True False],</span>
<span class="go">    fill_value = 999999)</span>
</pre></div>
</div>
<p>The mask is also available directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mask</span>
<span class="go">array([False, False, False,  True, False], dtype=bool)</span>
</pre></div>
</div>
<p>The masked entries can be filled with a given value to get an usual
array back:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span>
<span class="go">array([ 1,  9,  3, -1,  5])</span>
</pre></div>
</div>
<p>The mask can also be cleared:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">nomask</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mx</span>
<span class="go">masked_array(data = [1 9 3 -99 5],</span>
<span class="go">            mask = [False False False False False],</span>
<span class="go">    fill_value = 999999)</span>
</pre></div>
</div>
<p class="rubric">Domain-aware functions</p>
<p>The masked array package also contains domain-aware functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]))</span>
<span class="go">masked_array(data = [0.0 0.69314718056 -- -- 1.09861228867 --],</span>
<span class="go">            mask = [False False  True  True False  True],</span>
<span class="go">    fill_value = 1e+20)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Streamlined and more seamless support for dealing with missing data
in arrays is making its way into Numpy 1.7.  Stay tuned!</p>
</div>
<div class="topic">
<p class="topic-title first">Example: Masked statistics</p>
<p>Canadian rangers were distracted when counting hares and lynxes in
1903-1910 and 1917-1918, and got the numbers are wrong. (Carrot
farmers stayed alert, though.)  Compute the mean populations over
time, ignoring the invalid numbers.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s">&#39;../../data/populations.txt&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">year</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">bad_years</span> <span class="o">=</span> <span class="p">(((</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1903</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">1910</span><span class="p">))</span>
<span class="gp">... </span>           <span class="o">|</span> <span class="p">((</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">1917</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">1918</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="p">[</span><span class="n">bad_years</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="p">[</span><span class="n">bad_years</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">masked_array(data = [40472.7272727 18627.2727273 42400.0],</span>
<span class="go">             mask = [False False False],</span>
<span class="go">      fill_value = 1e+20)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">populations</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="go">masked_array(data = [21087.656489 15625.7998142 3322.50622558],</span>
<span class="go">             mask = [False False False],</span>
<span class="go">       fill_value = 1e+20)</span>
</pre></div>
</div>
<p>Note that Matplotlib knows about masked arrays:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">populations</span><span class="p">,</span> <span class="s">&#39;o-&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>[<a class="reference external" href="../../plot_directive/pyplots/numpy_intro_8.py">source code</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_8.hires.png">hires.png</a>, <a class="reference external" href="../../plot_directive/pyplots/numpy_intro_8.pdf">pdf</a>]</p>
<img alt="../../_images/numpy_intro_8.png" src="../../_images/numpy_intro_8.png" />
</div>
</div>
</div>
<div class="section" id="under-the-hood-the-memory-layout-of-a-numpy-array">
<h2><a class="toc-backref" href="#id34">Under the hood: the memory layout of a numpy array</a><a class="headerlink" href="#under-the-hood-the-memory-layout-of-a-numpy-array" title="Permalink to this headline">¶</a></h2>
<p>A numpy array is:</p>
<blockquote>
<div><p>block of memory + indexing scheme + data type descriptor</p>
<ul class="simple">
<li>raw data</li>
<li>how to locate an element</li>
<li>how to interpret an element</li>
</ul>
</div></blockquote>
<img alt="../../_images/threefundamental1.png" src="../../_images/threefundamental1.png" />
<div class="section" id="block-of-memory">
<h3><a class="toc-backref" href="#id35">Block of memory</a><a class="headerlink" href="#block-of-memory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;read-write buffer for 0xa37bfd8, size 16, offset 0 at 0xa4eabe0&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&#39;\x01\x00\x00\x00\x02\x00\x00\x00\x03\x00\x00\x00\x04\x00\x00\x00&#39;</span>
</pre></div>
</div>
<p>Memory address of the data:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">159755776</span>
</pre></div>
</div>
<p>Reminder: two <tt class="xref py py-class docutils literal"><span class="pre">ndarrays</span></tt> may share the same memory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">array([9, 2, 3, 4])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">x</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Memory does not need to be owned by an <tt class="xref py py-class docutils literal"><span class="pre">ndarray</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x01\x02\x03\x04</span><span class="s">&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">array([1, 2, 3, 4], dtype=int8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">data</span>
<span class="go">&lt;read-only buffer for 0xa588ba8, size 4, offset 0 at 0xa55cd60&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">base</span> <span class="ow">is</span> <span class="n">x</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">flags</span>
<span class="go">  C_CONTIGUOUS : True</span>
<span class="go">  F_CONTIGUOUS : True</span>
<span class="go">  OWNDATA : False</span>
<span class="go">  WRITEABLE : False</span>
<span class="go">  ALIGNED : True</span>
<span class="go">  UPDATEIFCOPY : False</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">owndata</span></tt> and <tt class="docutils literal"><span class="pre">writeable</span></tt> flags indicate status of the memory
block.</p>
</div>
<div class="section" id="indexing-scheme-strides">
<h3><a class="toc-backref" href="#id36">Indexing scheme: strides</a><a class="headerlink" href="#indexing-scheme-strides" title="Permalink to this headline">¶</a></h3>
<p><strong>The question</strong></p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="go">                  [4, 5, 6],</span>
<span class="go">                  [7, 8, 9]], dtype=np.int8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&#39;\x01\x02\x03\x04\x05\x06\x07\x08\x09&#39;</span>
</pre></div>
</div>
<p>At which byte in <tt class="docutils literal"><span class="pre">x.data</span></tt> does the item <tt class="docutils literal"><span class="pre">x[1,2]</span></tt> begin?</p>
</div></blockquote>
<p><strong>The answer</strong> (in Numpy)</p>
<blockquote>
<div><ul class="simple">
<li><strong>strides</strong>: the number of bytes to jump to find the next element</li>
<li>1 stride per dimension</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(3, 1)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">byte_offset</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">*</span><span class="mi">2</span>   <span class="c"># to find x[1,2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">byte_offset</span><span class="p">]</span>
<span class="go">&#39;\x06&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
<span class="go">6</span>
</pre></div>
</div>
<ul class="simple">
<li>simple, <strong>flexible</strong></li>
</ul>
</div></blockquote>
<p class="rubric">C and Fortran order</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
<span class="go">                  [4, 5, 6],</span>
<span class="go">                  [7, 8, 9]], dtype=np.int16, order=&#39;C&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(6, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&#39;\x01\x00\x02\x00\x03\x00\x04\x00\x05\x00\x06\x00\x07\x00\x08\x00\t\x00&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Need to jump 6 bytes to find the next row</li>
<li>Need to jump 2 bytes to find the next column</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(2, 6)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&#39;\x01\x00\x04\x00\x07\x00\x02\x00\x05\x00\x08\x00\x03\x00\x06\x00\t\x00&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Need to jump 2 bytes to find the next row</li>
<li>Need to jump 6 bytes to find the next column</li>
</ul>
<ul>
<li><p class="first">Similarly to higher dimensions:</p>
<ul class="simple">
<li>C: last dimensions vary fastest (= smaller strides)</li>
<li>F: first dimensions vary fastest</li>
</ul>
<div class="math">
<p><img src="../../_images/math/95ec125db02dd68e18b6eea77903b79254ccbc1f.png" alt="\mathrm{shape} &amp;= (d_1, d_2, ..., d_n)
\\
\mathrm{strides} &amp;= (s_1, s_2, ..., s_n)
\\
s_j^C &amp;= d_{j+1} d_{j+2} ... d_{n} \times \mathrm{itemsize}
\\
s_j^F &amp;= d_{1} d_{2} ... d_{j-1} \times \mathrm{itemsize}"/></p>
</div></li>
</ul>
<p class="rubric">Slicing</p>
<ul class="simple">
<li><em>Everything</em> can be represented by changing only <tt class="docutils literal"><span class="pre">shape</span></tt>, <tt class="docutils literal"><span class="pre">strides</span></tt>,
and possibly adjusting the <tt class="docutils literal"><span class="pre">data</span></tt> pointer!</li>
<li>Never makes copies of the data</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span>
<span class="go">array([6, 5, 4, 3, 2, 1])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(-4,)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">y</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">__array_interface__</span><span class="p">[</span><span class="s">&#39;data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="go">8</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(800, 80, 8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">[::</span><span class="mi">2</span><span class="p">,::</span><span class="mi">3</span><span class="p">,::</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(1600, 240, 32)</span>
</pre></div>
</div>
<ul class="simple">
<li>Similarly, transposes never make copies (it just swaps strides)</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(800, 80, 8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(8, 80, 800)</span>
</pre></div>
</div>
<p class="rubric">Reshaping</p>
<p>But: not all reshaping operations can be represented by playing with
strides.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">strides</span>
<span class="go">(1, 2)</span>
</pre></div>
</div>
<p>So far, so good. However:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">&#39;\x00\x01\x02\x03\x04\x05&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">array([[0, 2, 4],</span>
<span class="go">       [1, 3, 5]], dtype=int8)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">array([0, 2, 4, 1, 3, 5], dtype=int8)</span>
</pre></div>
</div>
<p>Here, there is no way to represent the array <tt class="docutils literal"><span class="pre">c</span></tt> given one stride
and the block of memory for <tt class="docutils literal"><span class="pre">a</span></tt>. Therefore, the <tt class="docutils literal"><span class="pre">reshape</span></tt>
operation needs to make a copy here.</p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id37">Summary</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">Numpy array: block of memory + indexing scheme + data type description</p>
</li>
<li><p class="first">Indexing: strides</p>
<p><tt class="docutils literal"><span class="pre">byte_position</span> <span class="pre">=</span> <span class="pre">np.sum(arr.strides</span> <span class="pre">*</span> <span class="pre">indices)</span></tt></p>
</li>
<li><p class="first">Various tricks can you do by playing with the strides (stuff for an
advanced tutorial it is)</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="../../index.html">Scipy lecture notes</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>